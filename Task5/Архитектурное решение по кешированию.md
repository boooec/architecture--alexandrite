### Мотивация  

Операторы MES жалуются на низкую скорость работы системы, а клиенты отмечают долгий процесс выполнения заказа. Это происходит по следующим причинам:  

- Высокая нагрузка на базу данных: каждое открытие страницы оператором вызывает множественные запросы к БД для загрузки списка заказов.  
- Частый доступ к неизменяющимся данным: статус заказов обновляется не так часто, но каждый раз загружается заново.  
- Замедленная обработка заказов: повторные запросы к MES приводят к задержкам в цепочке обработки.  

Решение: Внедрение кеширования позволит сократить нагрузку на базу данных, ускорить загрузку списка заказов и повысить отзывчивость системы.  

### Предлагаемое решение  

Для ускорения работы MES предлагается внедрить серверное кеширование с использованием Redis.  

Выбранный паттерн: Cache-Aside  
- Почему? Данные о заказах обновляются неравномерно, а частые запросы операторов требуют высокой производительности.  
- Почему не Write-Through? Этот паттерн увеличил бы нагрузку на кеш, так как каждое обновление данных автоматически попадало бы в кеш.  
- Почему не Refresh-Ahead? Данный паттерн подходит для предсказуемых данных с четкими интервалами обновления, но заказы могут обновляться в разное время.  

#### Кешируемые данные  

| Данные                                | Кешируемый элемент                        | Время жизни (TTL) | Причина кеширования                           |
| ------------------------------------- | ----------------------------------------- | ----------------- | --------------------------------------------- |
| Список заказов                        | Заказы в статусах "в работе" и "завершен" | 10 минут          | Чаще всего операторы работают с этим списком  |
| Детали заказа                         | Информация о конкретном заказе            | 5 минут           | Запросы на детализацию не так часты, но важны |
| Часто запрашиваемые справочные данные | Справочник товаров, статусы заказов       | 1 час             | Эти данные редко меняются                     |

#### Стратегия инвалидации кеша  

Выбрана инвалидация по ключу.  

- Почему? Позволяет обновлять кеш только тогда, когда данные действительно изменились.  
- Почему не временная (TTL)? Временной кешинг может приводить к устаревшей информации, если данные обновятся раньше истечения TTL.  
- Почему не программная? Усложняет логику приложения и требует дополнительного контроля за обновлением кеша.  

### Процесс кеширования  

#### Чтение списка заказов  

1. Оператор запрашивает список заказов.  
2. Система проверяет, есть ли данные в кешe Redis.  
3. Если данные есть в кешe – они возвращаются оператору.  
4. Если данных в кешe нет – система загружает их из БД, сохраняет в кеш и отдает оператору.  

#### Обновление статуса заказа  

1. Оператор изменяет статус заказа.  
2. Система обновляет данные в БД.  
3. После успешного обновления система удаляет кеш для списка заказов и конкретного заказа.  
4. При следующем запросе данные загружаются из БД и заносятся в кеш.  

### Диаграмма последовательности (Sequence Diagram)  

[Диаграмма](cache.drawio)

### Сравнительный анализ стратегий кеширования  

| Стратегия     | Преимущества                                 | Недостатки                                 |
| ------------- | -------------------------------------------- | ------------------------------------------ |
| Cache-Aside   | Гибкость, кеш обновляется только при запросе | Возможны задержки при первом запросе       |
| Write-Through | Данные всегда в кеше, нет устаревших данных  | Увеличенная нагрузка на кеш                |
| Refresh-Ahead | Предсказуемость обновления данных            | Требует точного прогнозирования обновлений |
